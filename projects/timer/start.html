<script src="https://www.gstatic.com/firebasejs/5.0.3/firebase.js"></script>
<link href="/projects/timer/all.css" rel="stylesheet" type="text/css"></link>
<div style="position:fixed;top:10vh;left:25vw;margin:auto;text-align:center;width:50vw;padding-top:7.5vh;">
  <button onclick="starter();">START</button>
  <div class="watch" style="position:fixed;top:55vh;left:50%;transform:translate(-50%,0);">
    WAITING FOR START...
  </div>
</div>
<script>
  window.onload=function(){
    clearall();
  }
  var start=0;
  var go=false;
  var toggle=false;
  var timer=0;
  var interval;
  function starter(){
    if(toggle==false){
      document.querySelectorAll("button")[0].innerHTML="STOP";
      clearall();
      start=new Date().getTime();
      go=true;
      toggle=true;
      document.querySelectorAll(".watch")[0].innerHTML='WAITING FOR FINISH...';
    }else{
      go=false;
      start=0;
      document.querySelectorAll("button")[0].innerHTML="START";
      toggle=false;
      document.querySelectorAll(".watch")[0].innerHTML='WAITING FOR START...';
    }
  }
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyD1wxkBnNNCmvJ0VONthEUKhtVdq5cxNDU",
    authDomain: "track-and-field-live-timer.firebaseapp.com",
    databaseURL: "https://track-and-field-live-timer.firebaseio.com",
    projectId: "track-and-field-live-timer",
    storageBucket: "track-and-field-live-timer.appspot.com",
    messagingSenderId: "1013172515547"
  };
  firebase.initializeApp(config);
  function clearall(){
    go=false;
    start=0;
    document.querySelectorAll(".rank")[0].innerHTML="";
    firebase.database().ref('times').remove();
  }
  var alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  for(var i=0;i<10;i++){
    var starCountRef = firebase.database().ref('times/' + alphabet[i]+"/time");
    starCountRef.on('value', function(snapshot) {
      update(snapshot.val());
    });
  }
  function update(value){
    if(value!=null&&go==true){
     var letter=value.split(",")[0];
     var time=parseInt(value.split(",")[1]);
     console.log(letter+" - "+((start-time)*-1).toString());
     rank(letter,((start-time)/1000*-1).toString());
     //console.log(letter);
     //console.log(time);
    }else{
//     clearall();
    }
  }
  function rank(letter,time){
    document.querySelectorAll(".rank")[0].innerHTML+="Runner "+letter+" : "+time+" seconds<br />";
  }
</script>
<div class="rank" style="padding-top:60vh;height:40%;overflow-y:auto;"></div>
