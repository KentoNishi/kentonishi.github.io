<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://kentonishi.github.io/projects/authorization/index.css" rel="stylesheet" type="text/css"></link>
<script src="https://kentonishi.github.io/projects/authorization/sha256.js"></script>
<script>
  function alpha(e) {
    var k;
    document.all ? k = e.keyCode : k = e.which;
    return k;
//    return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k >= 48 && k <= 57));
  }
  
  var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
  var eventer = window[eventMethod];
  var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
  eventer(messageEvent,function(e) {
    if(e.origin.indexOf("kentonishi")!=-1){
//      alert(sha256(username+"=:="+password)+","+e.data.replace("undefined", ""));
      if(e.data.replace("undefined", "")==sha256(username+"=:="+encodeURIComponent(password))){
        alert("Success!");
        location.reload();
      }else{
        alert("The password is incorrect.");
        location.reload();
      }
    }
  });
  
  var username="";
  var password="";
  function saveinput(){
    username=document.querySelectorAll(".username")[0].value;
    password=document.querySelectorAll(".password")[0].value;
  }
  
  function loadframe(){ 
    saveinput();
    document.querySelectorAll("iframe")[0].src="https://tinyurl.com/redirect.php?num=applicationsystemuser"+username;
  }
</script>

<input class="username" value="username" onkeypress="return alpha(event)"></input>
<input class="password" type="password"></input>
<button onclick="loadframe();this.style.display='none';">Sign In</button>
<iframe src="" onload="setTimeout(loaded, 1000);"></iframe>


<script src="https://apis.google.com/js/platform.js" async defer></script>
<meta name="google-signin-client_id" content="939148943087-open205atcokns8tc1o1b41svjkfvddh.apps.googleusercontent.com">
<div class="g-signin2" data-onsuccess="onSignIn"></div>
<script>
function onSignIn(googleUser) {
  var profile = googleUser.getBasicProfile();
  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
  console.log('Name: ' + profile.getName());
  console.log('Image URL: ' + profile.getImageUrl());
  console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
  document.querySelectorAll(".username")[0].value=profile.getEmail();
  document.querySelectorAll(".password")[0].value=profile.getId();
  document.querySelectorAll("button")[0].click();
}
  function signOut() {
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
      console.log('User signed out.');
    });
  }
</script>
