<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://kentonishi.github.io/projects/authorization/index.css" rel="stylesheet" type="text/css"></link>
<script src="https://kentonishi.github.io/projects/authorization/sha256.js"></script>

<script>
  function loadframe(){
    saveinput();
    document.querySelectorAll("iframe")[0].src="https://tinyurl.com/redirect.php?num=applicationsystemuser"+username;
  }
  
  var loadcount=0;
  function loaded(){
    if(loadcount>0){
      saveinput();
      confirm();
    }
    loadcount++;
  }
  
  var username="";
  var password1="";
  var password2="";
  function saveinput(){
    username=document.querySelectorAll(".username")[0].value;
    password1=document.querySelectorAll(".password")[0].value;
    password2=document.querySelectorAll(".password")[1].value;
  }
  
  
  var messaged=false;
  function confirm(){
    if(messaged==false){
      document.querySelectorAll(".field")[0].style.display="block";
    }else{
      alert("Your username has been taken.");
      location.reload();
    }
  }
  
  function create(){
    saveinput();
    if(password1!=password2){
      alert("Passwords do not match.");
    }else{
      document.querySelectorAll("iframe")[1].src="https://kentonishi.github.io/projects/authorization/create/account.html#"+username+"&"+encodeURIComponent(password1);
    }
  }
  
  var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
  var eventer = window[eventMethod];
  var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
  eventer(messageEvent,function(e) {
    if(e.origin.indexOf("kentonishi")!=-1){
      messaged=true;
    }
  });
</script>

<input class="username" value="username"></input>
<button onclick="loadframe();this.style.display='none';">Check Username</button>
<div class="field" style="display:none;">
  <h1>Username Available!</h1>
  <input class="password" type="password"></input>
  <input class="password" type="password"></input>
  <button class="signup" onclick="create();this.style.display='none';">Sign Up</button>
</div>
<iframe src="" onload="setTimeout(loaded, 1000);"></iframe>
<iframe src=""></iframe>
