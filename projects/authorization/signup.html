<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link href="https://kentonishi.github.io/projects/authorization/index.css" rel="stylesheet" type="text/css"></link>
<script src="https://kentonishi.github.io/projects/authorization/sha256.js"></script>

<script>
  function alpha(e) {
    var k;
    document.all ? k = e.keyCode : k = e.which;
    return ((k > 64 && k < 91) || (k > 96 && k < 123) || k == 8 || k == 32 || (k >= 48 && k <= 57));
  }
  
  function loadframe(){
    saveinput();
//    document.querySelectorAll("iframe")[0].src="https://tinyurl.com/redirect.php?num=applicationsystemuser"+username;
    loaded();
  }
  
  var loadcount=0;
  function loaded(){
    if(loadcount>0){
      saveinput();
      confirm();
    }
    loadcount++;
  }
  
  var username="";
  var password1="";
  var password2="";
  function saveinput(){
    username=document.querySelectorAll(".username")[0].value;
    password1=document.querySelectorAll(".password")[0].value;
    password2=document.querySelectorAll(".password")[1].value;
  }
  
  
  var messaged=false;
  function confirm(){
    if(messaged==false){
      document.querySelectorAll(".field")[0].style.display="block";
      document.querySelectorAll(".username")[0].style.display="none";
      document.querySelectorAll("button")[1].click();
    }else{
      alert("Your username has been taken.");
      location.reload();
    }
  }
  
  function create(){
    saveinput();
    if(password1!=password2){
      alert("Passwords do not match.");
      document.querySelectorAll(".signup")[0].style.display="block";
    }else{
      document.querySelectorAll("iframe")[1].src="https://kentonishi.github.io/projects/authorization/create/account.html#"+username+"&"+encodeURIComponent(password1);
    }
  }
  
  var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
  var eventer = window[eventMethod];
  var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
  eventer(messageEvent,function(e) {
    if(e.origin.indexOf("kentonishi")!=-1){
      messaged=true;
    }
  });
</script>

<div class="hidden">
<input class="username" value="username" onkeypress="return alpha(event)"></input>
<button onclick="loadframe();this.style.display='none';">Check Username</button>
<div class="field" style="display:none;">
  <h1>Username Available!</h1>
  <input class="password" type="password"></input>
  <br />
  <input class="password" type="password"></input>
  <br />
  <button class="signup" onclick="this.style.display='none';create();">Sign Up</button>
</div>
<iframe src="" onload="setTimeout(loaded, 1000);"></iframe>
<iframe src=""></iframe>
</div>
<script src="https://apis.google.com/js/platform.js" async defer></script>
<meta name="google-signin-client_id" content="939148943087-open205atcokns8tc1o1b41svjkfvddh.apps.googleusercontent.com">
<div class="g-signin2" data-onsuccess="onSignIn"></div>

<script>
function onSignIn(googleUser) {
  var profile = googleUser.getBasicProfile();
  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
  console.log('Name: ' + profile.getName());
  console.log('Image URL: ' + profile.getImageUrl());
  console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
  document.querySelectorAll(".username")[0].value=profile.getEmail().replace("@", "");
  document.querySelectorAll(".password")[0].value=profile.getId();
  document.querySelectorAll(".password")[1].value=profile.getId();
  document.querySelectorAll("button")[0].click();
}
  function signOut() {
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
      console.log('User signed out.');
    });
  }
</script>
